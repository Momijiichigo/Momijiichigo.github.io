import React from 'react'
import anime from 'animejs/lib/anime.es.js'
import '../css/splash.scss'
window.onSplashEndFunctions = [];
window.onsplashend=()=>{};
export default class extends React.Component {
  
  
  componentDidMount() {
    const splashScreen = document.querySelector('#splash')
    const logoGrad = document.querySelector('svg#logo_anime #logo_grad')
    logoGrad.setAttribute('x1','-20px')
    logoGrad.setAttribute('x2', '20px')
    logoGrad.setAttribute('y1', '-57.73502691896257px')
    logoGrad.setAttribute('y2', '57.73502691896257px')
    const logoG = document.querySelector('svg#logo_anime g')
    const dur = 1300
    const fadeoutTime = 700
    let bw, bh, bigger
    window.onsplashend = (func) =>{
      window.onSplashEndFunctions.push(func);
    }
    const onResize = () => {
      bw = document.body.clientWidth
      bh = document.body.clientHeight
      bigger = Math.max(bw,bh)
      logoG.setAttribute('transform', `translate(${bw/2} ${bh/2})`)
    }
    onResize()
    window.addEventListener('resize',onResize)
    
    anime({
      targets: 'svg#logo_anime path#centri',
      d: [
        {
          value: [
            'M 0 0 l 0 0 l 0 0 z',
            'M 0 0 l 0 0 l 0 0 z'
          ],
          duration: dur*4/6
        },
        {
          value: `M 0 -23.094010767585026 l 20 34.64101615137754 l -40 0 z`,
          duration: 0,
        }
      ],
      duration: dur,
    })
    anime({
      targets: 'svg#logo_anime path#around',
      d: [
        {
          value: [
            ` M ${-20+bigger*0.34641016151377546}  ${-57.73502691896257+bigger*0.6} l -10 17.32050807568877 l 10 17.32050807568877 l 20 0 z m ${40-bigger*0.6928203230275509}  ${34.64101615137754-bigger*1.2} l 20 0 l -20 -34.64101615137754 l -20 0 z M ${59.999999999999986+bigger*0.34641016151377546*-0.4999999999999998-bigger*0.6*0.8660254037844387}  ${11.547005383792495+bigger*0.34641016151377546*0.8660254037844387+bigger*0.6*-0.4999999999999998} l -10.000000000000002 -17.32050807568877 l -20 5.329070518200751e-15 l -9.999999999999996 17.320508075688775 z m ${-49.99999999999999-bigger*0.6928203230275509*-0.4999999999999998+bigger*1.2*0.8660254037844387}  ${17.320508075688785-bigger*0.6928203230275509*0.8660254037844387-bigger*1.2*-0.4999999999999998} l -9.999999999999996 17.320508075688775 l 40 -1.0658141036401503e-14 l 9.999999999999996 -17.320508075688775 z M ${-39.99999999999998+bigger*0.34641016151377546*-0.5000000000000004-bigger*0.6*-0.8660254037844385}  ${46.18802153517008+bigger*0.34641016151377546*-0.8660254037844385+bigger*0.6*-0.5000000000000004} l 20 -7.105427357601002e-15 l 9.999999999999993 -17.320508075688778 l -10.000000000000009 -17.32050807568877 z m ${9.999999999999975-bigger*0.6928203230275509*-0.5000000000000004+bigger*1.2*-0.8660254037844385}  ${-51.96152422706633-bigger*0.6928203230275509*-0.8660254037844385-bigger*1.2*-0.5000000000000004} l -10.000000000000009 -17.32050807568877 l -19.999999999999986 34.641016151377556 l 10.000000000000009 17.32050807568877 z`,
            ` M ${-20+bigger*0.34641016151377546}  ${-57.73502691896257+bigger*0.6} l -10 17.32050807568877 l 10 17.32050807568877 l 20 0 z m ${40-bigger*0.6928203230275509}  ${34.64101615137754-bigger*1.2} l 20 0 l -20 -34.64101615137754 l -20 0 z M ${59.999999999999986+bigger*0.34641016151377546*-0.4999999999999998-bigger*0.6*0.8660254037844387}  ${11.547005383792495+bigger*0.34641016151377546*0.8660254037844387+bigger*0.6*-0.4999999999999998} l -10.000000000000002 -17.32050807568877 l -20 5.329070518200751e-15 l -9.999999999999996 17.320508075688775 z m ${-49.99999999999999-bigger*0.6928203230275509*-0.4999999999999998+bigger*1.2*0.8660254037844387}  ${17.320508075688785-bigger*0.6928203230275509*0.8660254037844387-bigger*1.2*-0.4999999999999998} l -9.999999999999996 17.320508075688775 l 40 -1.0658141036401503e-14 l 9.999999999999996 -17.320508075688775 z M ${-39.99999999999998+bigger*0.34641016151377546*-0.5000000000000004-bigger*0.6*-0.8660254037844385}  ${46.18802153517008+bigger*0.34641016151377546*-0.8660254037844385+bigger*0.6*-0.5000000000000004} l 20 -7.105427357601002e-15 l 9.999999999999993 -17.320508075688778 l -10.000000000000009 -17.32050807568877 z m ${9.999999999999975-bigger*0.6928203230275509*-0.5000000000000004+bigger*1.2*-0.8660254037844385}  ${-51.96152422706633-bigger*0.6928203230275509*-0.8660254037844385-bigger*1.2*-0.5000000000000004} l -10.000000000000009 -17.32050807568877 l -19.999999999999986 34.641016151377556 l 10.000000000000009 17.32050807568877 z`],
        },
        {
        value: ` M ${-20+bigger/6.928203230275509}  ${-57.73502691896257+bigger/4} l -10 17.32050807568877 l 70 121.2435565298214 l 20 0 z m ${40-bigger/3.4641016151377544}  ${34.64101615137754-bigger/2} l 20 0 l -140 -242.4871130596428 l -20 0 z M ${59.999999999999986+bigger/6.928203230275509*-0.4999999999999998-bigger/4*0.8660254037844387}  ${11.547005383792495+bigger/6.928203230275509*0.8660254037844387+bigger/4*-0.4999999999999998} l -10.000000000000002 -17.32050807568877 l -140 3.552713678800501e-14 l -9.999999999999996 17.320508075688775 z m ${-49.99999999999999-bigger/3.4641016151377544*-0.4999999999999998+bigger/2*0.8660254037844387}  ${17.320508075688785-bigger/3.4641016151377544*0.8660254037844387-bigger/2*-0.4999999999999998} l -9.999999999999996 17.320508075688775 l 280 -7.105427357601002e-14 l 9.999999999999996 -17.320508075688775 z M ${-39.99999999999998+bigger/6.928203230275509*-0.5000000000000004-bigger/4*-0.8660254037844385}  ${46.18802153517008+bigger/6.928203230275509*-0.8660254037844385+bigger/4*-0.5000000000000004} l 20 -7.105427357601002e-15 l 69.99999999999994 -121.24355652982146 l -10.000000000000009 -17.32050807568877 z m ${9.999999999999975-bigger/3.4641016151377544*-0.5000000000000004+bigger/2*-0.8660254037844385}  ${-51.96152422706633-bigger/3.4641016151377544*-0.8660254037844385-bigger/2*-0.5000000000000004} l -10.000000000000009 -17.32050807568877 l -139.9999999999999 242.48711305964292 l 10.000000000000009 17.32050807568877 z`,
        duration: dur/4,
        easing: 'easeInCubic'
      },
      {
        value: ` M 0 -23.094010767585026 l -10 17.32050807568877 l 15 25.980762113533157 l 20 0 z m 0 -34.64101615137754 l 20 0 l -30 -51.96152422706631 l -20 0 z M 19.999999999999996 11.547005383792508 l -10.000000000000002 -17.32050807568877 l -29.999999999999996 7.105427357601002e-15 l -9.999999999999996 17.320508075688775 z m 30 17.320508075688764 l -9.999999999999996 17.320508075688775 l 59.99999999999999 -1.4210854715202004e-14 l 9.999999999999996 -17.320508075688775 z M -19.999999999999993 11.547005383792524 l 20 -7.105427357601002e-15 l 14.999999999999986 -25.980762113533167 l -10.000000000000009 -17.32050807568877 z m -29.999999999999993 17.320508075688785 l -10.000000000000009 -17.32050807568877 l -29.99999999999997 51.961524227066334 l 10.000000000000009 17.32050807568877 z`,
        duration: dur/6,
        easing: 'linear'
      },
        {
          value: ` M -20 -57.73502691896257 l -10 17.32050807568877 l 10 17.32050807568877 l 20 0 z m 40 34.64101615137754 l 20 0 l -20 -34.64101615137754 l -20 0 z M 59.999999999999986 11.547005383792495 l -10.000000000000002 -17.32050807568877 l -20 5.329070518200751e-15 l -9.999999999999996 17.320508075688775 z m -49.99999999999999 17.320508075688785 l -9.999999999999996 17.320508075688775 l 40 -1.0658141036401503e-14 l 9.999999999999996 -17.320508075688775 z M -39.99999999999998 46.18802153517008 l 20 -7.105427357601002e-15 l 9.999999999999993 -17.320508075688778 l -10.000000000000009 -17.32050807568877 z m 9.999999999999975 -51.96152422706633 l -10.000000000000009 -17.32050807568877 l -19.999999999999986 34.641016151377556 l 10.000000000000009 17.32050807568877 z`,
          easing: 'easeOutCubic',
        }
        
      ],
      duration: dur,
    })
    anime({
      targets: 'svg#logo_anime stop[offset="85%"]',
      'stop-color': [
        {value: '#6ce9fb'},
        {value: '#d15af9'}, 
      ],
      easing: 'easeInCubic',
      delay: dur-900,
      duration: 1500,
    })
    anime({
      targets: 'svg#logo_anime',
      filter: [
        {value: 'drop-shadow(0px 0px 0px #8fd0ff)'},
        {value: 'drop-shadow(0px 0px 15px #8fd0ff)'},
        {value: 'drop-shadow(0px 0px 5px #8fd0ff)'},
        {value: 'drop-shadow(0px 0px 0px #8fd0ff)'}
      ],
      easing: 'easeInOutCubic',
      delay: dur,
      duration: 800,
    })
    
    setTimeout(() => {
      splashScreen.style.transition = fadeoutTime/1000 + 's'
      splashScreen.style.opacity = 0
      
      setTimeout(() => {
        window.onSplashEndFunctions.forEach(v=>v())
      }, fadeoutTime/2)
      setTimeout(() => {
        splashScreen.remove()
      }, fadeoutTime)
    },3000)
  }

  render() {
    return (
      <div id='splash'>
        <svg id='logo_anime'>
          <linearGradient xmlns='http://www.w3.org/2000/svg' id='logo_grad'  gradientUnits='userSpaceOnUse'>
            <stop offset="0%" stopColor='#01fdff' ></stop>
            <stop offset="85%" stopColor='#01fdff' ></stop>
          </linearGradient>
          <g stroke='transparent'>
            <path id='around' d='M 0 0 l 0 0 l 0 0 l 0 0 z m 0 0 l 0 0 l 0 0 l 0 0 z M 0 0 l 0 0 l 0 0 l 0 0 z m 0 0 l 0 0 l 0 0 l 0 0 z M 0 0 l 0 0 l 0 0 l 0 0 z m 0 0 l 0 0 l 0 0 l 0 0 z M 0 0 l 0 0 l 0 0' >
            </path>
            <path id='centri' d=' M 0 0 l 0 0 l 0 0 z'></path>
          </g>
        </svg>
      </div>
    )
  }
}